<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>نظام التقييم الموحد</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: #f0f2f5; direction: rtl; padding: 20px; }
        .card { max-width: 450px; margin: auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { color: #c0392b; text-align: center; margin-bottom: 20px; }
        label { display: block; margin-top: 15px; font-weight: bold; }
        select, input { width: 100%; padding: 12px; margin-top: 8px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; font-size: 16px; }
        button { width: 100%; padding: 15px; margin-top: 25px; border: none; border-radius: 6px; background: #27ae60; color: white; font-size: 18px; font-weight: bold; cursor: pointer; }
        button:hover { background: #219150; }
        .score-info { margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; text-align: center; border: 1px solid #eee; }
    </style>
</head>
<body>

<div class="card">
    <h2>نموذج التجربة النهائية</h2>
    
    <label>اسم الفرع:</label>
    <select id="branch-name">
        <option value="فرع التجربة 1">فرع التجربة 1</option>
        <option value="فرع التجربة 2">فرع التجربة 2</option>
    </select>

    <label>اسم المقيم:</label>
    <input type="text" id="evaluator-name" placeholder="اكتب اسمك هنا">

    <label>تاريخ التقييم:</label>
    <input type="date" id="eval-date">

    <div class="score-info">
        الدرجة: <span id="total-score">950</span> | 
        النسبة: <span id="percentage">95%</span>
    </div>

    <button type="button" id="submitBtn">إرسال البيانات الآن</button>
</div>

<script>
    // 1. ضع رابطك هنا بدقة
    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzXpCEABtIgKnPgWX4QYX4HCg7KeiNj64B1nLc2WAcGOF3uLGOj-xJko0eEPpk7-AA/exec";

    // 2. كود وضع تاريخ اليوم تلقائياً عند فتح الصفحة
    window.onload = function() {
        const today = new Date();
        const yyyy = today.getFullYear();
        let mm = today.getMonth() + 1; 
        let dd = today.getDate();

        if (dd < 10) dd = '0' + dd;
        if (mm < 10) mm = '0' + mm;

        const formattedToday = yyyy + '-' + mm + '-' + dd;
        document.getElementById('eval-date').value = formattedToday;
    };

    // 3. ربط الزر بالأمر (طريقة مضمونة أكثر)
    document.getElementById('submitBtn').addEventListener('click', async function() {
        const branch = document.getElementById('branch-name').value;
        const name = document.getElementById('evaluator-name').value;
        const date = document.getElementById('eval-date').value;
        const score = document.getElementById('total-score').innerText;
        const percent = document.getElementById('percentage').innerText;

        if (!name) {
            alert("من فضلك اكتب اسمك أولاً");
            return;
        }

        const data = {
            branch: branch,
            name: name,
            date: date,
            score: score,
            percent: percent
        };

        alert("جاري الإرسال... انتظر قليلاً");

        try {
            await fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                cache: 'no-cache',
                body: JSON.stringify(data)
            });
            alert("✅ تم الحفظ! افحص ملف جوجل شيت الآن.");
        } catch (error) {
            alert("❌ حدث خطأ في الاتصال: " + error.message);
        }
    });
</script>

</body>
</html>
